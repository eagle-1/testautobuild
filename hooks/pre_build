#!/usr/bin/env bash
set -eu

echo "ğŸ”µ start pre_build"
echo "â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯"
source hooks/.config

echo "âœ… Register qemu-*-static for all supported processors except current"
echo "â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯"

echo "check2: ls -la /proc/sys/fs/binfmt_misc"
ls -la /proc/sys/fs/binfmt_misc
echo "now running: docker run --rm --privileged aptman/qus -s -- -p arm"

#docker run --rm --privileged multiarch/qemu-user-static --reset
#docker run --rm --privileged aptman/qus -s -- -p arm

echo "check3: ls -la /proc/sys/fs/binfmt_misc"
ls -la /proc/sys/fs/binfmt_misc

echo "âœ…#################  start buildx tasks  ##################"
docker buildx ls
echo "âœ…#################  Create new buildx builder  ##################"
docker buildx create --name mybuilder
echo "âœ…#################  Use new buildx builder  ##################"
docker buildx use mybuilder
echo "âœ…#################  Inspect buildx builder  ##################"
docker buildx inspect --bootstrap
echo "âœ…################# done with pre_build  ##################"
echo "ğŸ”µ end pre_build"
echo "â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯"
